import * as ToolbarPrimitive from '@radix-ui/react-toolbar';
import * as TooltipPrimitive from '@radix-ui/react-tooltip';
import { cva } from 'class-variance-authority';
import { ChevronDown } from 'lucide-react';
import * as React from 'react';
import {
  DropdownMenuLabel,
  DropdownMenuRadioGroup,
  DropdownMenuSeparator,
} from './dropdown-menu';
import { Separator } from './separator';
import { Tooltip, TooltipTrigger } from './tooltip';
import { cn } from '../../lib/utils';
export const Toolbar = React.forwardRef(({ className, ...props }, ref) => (
  <ToolbarPrimitive.Root
    className={cn('relative flex select-none items-center', className)}
    ref={ref}
    {...props}
  />
));
Toolbar.displayName = 'Toolbar';
export const ToolbarToggleGroup = React.forwardRef(
  ({ className, ...props }, ref) => (
    <ToolbarPrimitive.ToolbarToggleGroup
      className={cn('flex items-center', className)}
      ref={ref}
      {...props}
    />
  )
);
ToolbarToggleGroup.displayName = 'ToolbarToggleGroup';
export const ToolbarLink = React.forwardRef(({ className, ...props }, ref) => (
  <ToolbarPrimitive.Link
    className={cn('font-medium underline underline-offset-4', className)}
    ref={ref}
    {...props}
  />
));
ToolbarLink.displayName = 'ToolbarLink';
export const ToolbarSeparator = React.forwardRef(
  ({ className, ...props }, ref) => (
    <ToolbarPrimitive.Separator
      className={cn('mx-2 my-1 w-px shrink-0 bg-border', className)}
      ref={ref}
      {...props}
    />
  )
);
ToolbarSeparator.displayName = 'ToolbarSeparator';
// From toggleVariants
const toolbarButtonVariants = cva(
  "inline-flex cursor-pointer items-center justify-center gap-2 whitespace-nowrap rounded-md font-medium text-sm outline-none transition-[color,box-shadow] hover:bg-muted hover:text-muted-foreground focus-visible:border-ring focus-visible:ring-[3px] focus-visible:ring-ring/50 disabled:pointer-events-none disabled:opacity-50 aria-checked:bg-accent aria-checked:text-accent-foreground aria-invalid:border-destructive aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
  {
    defaultVariants: {
      size: 'default',
      variant: 'default',
    },
    variants: {
      size: {
        default: 'h-9 min-w-9 px-2',
        lg: 'h-10 min-w-10 px-2.5',
        sm: 'h-8 min-w-8 px-1.5',
      },
      variant: {
        default: 'bg-transparent',
        outline:
          'border border-input bg-transparent shadow-xs hover:bg-accent hover:text-accent-foreground',
      },
    },
  }
);
const dropdownArrowVariants = cva(
  cn(
    'inline-flex items-center justify-center rounded-r-md font-medium text-foreground text-sm transition-colors disabled:pointer-events-none disabled:opacity-50'
  ),
  {
    defaultVariants: {
      size: 'sm',
      variant: 'default',
    },
    variants: {
      size: {
        default: 'h-9 w-6',
        lg: 'h-10 w-8',
        sm: 'h-8 w-4',
      },
      variant: {
        default:
          'bg-transparent hover:bg-muted hover:text-muted-foreground aria-checked:bg-accent aria-checked:text-accent-foreground',
        outline:
          'border border-input border-l-0 bg-transparent hover:bg-accent hover:text-accent-foreground',
      },
    },
  }
);
export const ToolbarButton = withTooltip(
  React.forwardRef(
    (
      {
        children,
        className,
        isDropdown,
        pressed,
        size = 'sm',
        variant,
        ...props
      },
      ref
    ) =>
      typeof pressed === 'boolean' ? (
        <ToolbarToggleGroup
          disabled={props.disabled}
          type="single"
          value={pressed ? 'single' : ''}
        >
          <ToolbarToggleItem
            className={cn(
              toolbarButtonVariants({
                size,
                variant,
              }),
              isDropdown && 'justify-between gap-1 pr-1',
              className
            )}
            ref={ref}
            value={pressed ? 'single' : ''}
            {...props}
          >
            {isDropdown ? (
              <>
                <div className="flex flex-1 items-center gap-2 whitespace-nowrap">
                  {children}
                </div>
                <div>
                  <ChevronDown
                    className="size-3.5 text-muted-foreground"
                    data-icon
                  />
                </div>
              </>
            ) : (
              children
            )}
          </ToolbarToggleItem>
        </ToolbarToggleGroup>
      ) : (
        <ToolbarPrimitive.Button
          className={cn(
            toolbarButtonVariants({
              size,
              variant,
            }),
            isDropdown && 'pr-1',
            className
          )}
          ref={ref}
          {...props}
        >
          {children}
        </ToolbarPrimitive.Button>
      )
  )
);
ToolbarButton.displayName = 'ToolbarButton';
export const ToolbarSplitButton = React.forwardRef(
  ({ className, ...props }, ref) => (
    <ToolbarButton
      className={cn('group flex gap-0 px-0 hover:bg-transparent', className)}
      ref={ref}
      {...props}
    />
  )
);
ToolbarSplitButton.displayName = 'ToolbarSplitButton';
export const ToolbarSplitButtonPrimary = React.forwardRef(
  ({ children, className, size = 'sm', variant, ...props }, ref) => (
    <span
      className={cn(
        toolbarButtonVariants({
          size,
          variant,
        }),
        'rounded-r-none',
        'group-data-[pressed=true]:bg-accent group-data-[pressed=true]:text-accent-foreground',
        className
      )}
      ref={ref}
      {...props}
    >
      {children}
    </span>
  )
);
ToolbarSplitButtonPrimary.displayName = 'ToolbarSplitButtonPrimary';
export const ToolbarSplitButtonSecondary = React.forwardRef(
  ({ className, size, variant, ...props }, ref) => (
    <span
      className={cn(
        dropdownArrowVariants({
          size,
          variant,
        }),
        'group-data-[pressed=true]:bg-accent group-data-[pressed=true]:text-accent-foreground',
        className
      )}
      onClick={(e) => e.stopPropagation()}
      ref={ref}
      role="button"
      {...props}
    >
      <ChevronDown className="size-3.5 text-muted-foreground" data-icon />
    </span>
  )
);
ToolbarSplitButtonSecondary.displayName = 'ToolbarSplitButtonSecondary';
export const ToolbarToggleItem = React.forwardRef(
  ({ className, size = 'sm', variant, ...props }, ref) => (
    <ToolbarPrimitive.ToggleItem
      className={cn(toolbarButtonVariants({ size, variant }), className)}
      ref={ref}
      {...props}
    />
  )
);
ToolbarToggleItem.displayName = 'ToolbarToggleItem';
export function ToolbarGroup({ children, className }) {
  return (
    <div
      className={cn(
        'group/toolbar-group',
        'relative hidden has-[button]:flex',
        className
      )}
    >
      <div className="flex items-center">{children}</div>

      <div className="group-last/toolbar-group:hidden! mx-1.5 py-0.5">
        <Separator orientation="vertical" />
      </div>
    </div>
  );
}
function withTooltip(Component) {
  const ExtendComponent = React.forwardRef(
    (
      {
        tooltip,
        tooltipContentProps,
        tooltipProps,
        tooltipTriggerProps,
        ...props
      },
      ref
    ) => {
      const [mounted, setMounted] = React.useState(false);
      React.useEffect(() => {
        setMounted(true);
      }, []);
      const component = <Component ref={ref} {...props} />;
      if (tooltip && mounted) {
        return (
          <Tooltip {...tooltipProps}>
            <TooltipTrigger asChild {...tooltipTriggerProps}>
              {component}
            </TooltipTrigger>

            <TooltipContent {...tooltipContentProps}>{tooltip}</TooltipContent>
          </Tooltip>
        );
      }
      return component;
    }
  );
  ExtendComponent.displayName = 'withTooltip';
  return ExtendComponent;
}
export const TooltipContent = React.forwardRef(
  ({ children, className, sideOffset = 4, ...props }, ref) => {
    return (
      <TooltipPrimitive.Portal>
        <TooltipPrimitive.Content
          className={cn(
            'z-50 w-fit origin-(--radix-tooltip-content-transform-origin) text-balance rounded-md bg-primary px-3 py-1.5 text-primary-foreground text-xs',
            className
          )}
          data-slot="tooltip-content"
          ref={ref}
          sideOffset={sideOffset}
          {...props}
        >
          {children}
          {/* CHANGE */}
          {/* <TooltipPrimitive.Arrow className="z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px] bg-primary fill-primary" /> */}
        </TooltipPrimitive.Content>
      </TooltipPrimitive.Portal>
    );
  }
);
TooltipContent.displayName = 'TooltipContent';
export function ToolbarMenuGroup({ children, className, label, ...props }) {
  return (
    <>
      <DropdownMenuSeparator
        className={cn(
          'hidden',
          'mb-0 shrink-0 peer-has-[[role=menuitem]]/menu-group:block peer-has-[[role=menuitemradio]]/menu-group:block peer-has-[[role=option]]/menu-group:block'
        )}
      />

      <DropdownMenuRadioGroup
        {...props}
        className={cn(
          'hidden',
          'peer/menu-group group/menu-group my-1.5 has-[[role=menuitem]]:block has-[[role=menuitemradio]]:block has-[[role=option]]:block',
          className
        )}
      >
        {label && (
          <DropdownMenuLabel className="select-none font-semibold text-muted-foreground text-xs">
            {label}
          </DropdownMenuLabel>
        )}
        {children}
      </DropdownMenuRadioGroup>
    </>
  );
}
